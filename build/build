#!/bin/bash

appName="MyCat"


if [ -z $appName ];then
  echo "appName 을 기술하세요"
  exit 1
fi


####################
#  App Bundle 생성  #
####################


if [ -d $appName.app ]; then rm -rf $appName.app; fi

mkdir $appName.app
mkdir $appName.app/Contents
mkdir $appName.app/Contents/MacOS
mkdir $appName.app/Contents/Resources
mkdir $appName.app/Contents/Frameworks

cp Info.plist $appName.app/Contents
cp -R ../assets/* $appName.app/Contents/Resources

###################
#  Framework 복사  #
###################

cp ~/quicklisp/local-projects/lib/cl-nextstep/libcl-nextstep.dylib $appName.app/Contents/Frameworks
install_name_tool -id @executable_path/../Frameworks/libcl-nextstep.dylib $appName.app/Contents/Frameworks/libcl-nextstep.dylib

###########
#  build  #
###########

sbcl --load build.lisp --eval "(save-lisp-and-die \"$appName.app/Contents/MacOS/sbcl.core\" :toplevel #'cl-user::build-toplevel-function)"
cp /usr/local/bin/sbcl $appName.app/Contents/MacOS/$appName



